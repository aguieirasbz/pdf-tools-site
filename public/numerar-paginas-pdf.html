<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Adicione números de página em arquivos PDF de forma fácil e customizável. Escolha posição, formato, estilo e mais.">
    <title>Numerar Páginas PDF | PDF TRUE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

    <style>
        :root {
            --primary-color: #ff000d;
            --secondary-color: #f30f2d;
            --light-gray: #f8f9fa;
            --white: #ffffff;
            --danger-color: #dc3545;
            --success-color: #28a745;
        }
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background-color: var(--light-gray);
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .tool-hero {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 40px 20px;
            text-align: center;
            border-radius: 0 0 10px 10px;
        }
        .tool-hero h1 { margin: 0; font-size: 2.5rem; }
        .tool-hero p { margin-top: 10px; font-size: 1.1rem; }
        .tool-container-wrapper {
            background-color: var(--white);
            margin-top: -20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 40px;
        }
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            position: relative;
        }
        .upload-area:hover, .upload-area.active {
            background-color: #f0f8ff;
            border-color: var(--primary-color);
        }
        .upload-area .fas { font-size: 50px; color: var(--primary-color); margin-bottom: 20px; }
        .file-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        
        .tool-options {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .tool-options h3 { margin-top: 0; color: var(--primary-color); }
        .form-group {
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }
        .form-group label {
            flex-basis: 200px;
            margin-right: 15px;
            font-weight: 500;
        }
        .form-group input, .form-group select {
            flex: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .form-group input[type="color"] { padding: 4px; min-height: 35px; }

        .tool-actions { text-align: center; margin-top: 30px; }
        .btn { display: inline-block; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: 500; text-decoration: none; color: var(--white); transition: background-color 0.3s, transform 0.2s; }
        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: #0056b3; }
        .btn:disabled { background-color: var(--secondary-color); cursor: not-allowed; }
        #tool-btn { font-size: 1.2rem; padding: 15px 40px; }

        .user-message { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 25px; border-radius: 5px; color: var(--white); z-index: 1000; font-size: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .user-message.error { background-color: var(--danger-color); }
        .user-message.success { background-color: var(--success-color); }
    </style>
</head>
<body>
    <div class="tool-page">
        <section class="tool-hero">
            <div class="container">
                <div class="tool-hero-content">
                    <h1><i class="fas fa-list-ol"></i> Numerar Páginas PDF</h1>
                    <p>Adicione números de página ao seu documento PDF com facilidade.</p>
                </div>
            </div>
        </section>
        <div class="container tool-container-wrapper">
            <div class="tool-main">
                <div class="upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>Arraste e solte seu PDF aqui</h3>
                    <p>ou</p>
                    <a class="btn btn-primary">Selecionar arquivo</a>
                    <input id="tool-input" type="file" class="file-input" accept=".pdf">
                    <p id="file-info" style="margin-top: 15px; color: var(--secondary-color);"></p>
                </div>
                
                <div class="tool-options">
                    <h3><i class="fas fa-cog"></i> Opções de Numeração</h3>
                    <div class="form-group">
                        <label for="position">Posição do número:</label>
                        <select id="position">
                            <option value="bottom-center">Rodapé, ao centro</option>
                            <option value="bottom-right">Rodapé, à direita</option>
                            <option value="bottom-left">Rodapé, à esquerda</option>
                            <option value="top-center">Cabeçalho, ao centro</option>
                            <option value="top-right">Cabeçalho, à direita</option>
                            <option value="top-left">Cabeçalho, à esquerda</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="format">Formato:</label>
                        <select id="format">
                            <option value="{p}">{p} (ex: 5)</option>
                            <option value="{p} / {t}">{p} / {t} (ex: 5 / 12)</option>
                            <option value="Página {p}">Página {p} (ex: Página 5)</option>
                            <option value="Página {p} de {t}">Página {p} de {t} (ex: Página 5 de 12)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="start-page">Iniciar na página:</label>
                        <input type="number" id="start-page" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="font-size">Tamanho da Fonte:</label>
                        <input type="number" id="font-size" value="12" min="1">
                    </div>
                    <div class="form-group">
                        <label for="font-color">Cor da Fonte:</label>
                        <input type="color" id="font-color" value="#000000">
                    </div>
                </div>

                <div class="tool-actions">
                    <button id="tool-btn" class="btn btn-primary btn-lg">NUMERAR PDF</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showUserMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.className = `user-message ${type}`;
            document.body.appendChild(messageDiv);
            setTimeout(() => { messageDiv.remove(); }, 4000);
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16)/255, g: parseInt(result[2], 16)/255, b: parseInt(result[3], 16)/255 } : { r: 0, g: 0, b: 0 };
        }
        
        async function addPageNumbersToPdf(file, options) {
            // ***** INÍCIO DA CORREÇÃO *****
            // A linha abaixo foi movida para DENTRO desta função.
            // Isso garante que a biblioteca PDFLib esteja totalmente carregada antes de tentarmos usá-la.
            const { PDFDocument, rgb, StandardFonts } = PDFLib;
            // ***** FIM DA CORREÇÃO *****

            const existingPdfBytes = await file.arrayBuffer();
            const pdfDoc = await PDFDocument.load(existingPdfBytes);
            const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica);
            
            const totalPages = pdfDoc.getPageCount();
            const pages = pdfDoc.getPages();

            if (options.startPage > totalPages) {
                 throw new Error(`A página inicial (${options.startPage}) é maior que o total de páginas (${totalPages}).`);
            }
            
            for (let i = options.startPage - 1; i < totalPages; i++) {
                const currentPageNumber = i + 1;
                const page = pages[i];
                const { width, height } = page.getSize();
                
                const numberText = options.format
                    .replace('{p}', currentPageNumber)
                    .replace('{t}', totalPages);
                    
                const textWidth = helveticaFont.widthOfTextAtSize(numberText, options.fontSize);
                const colorComponents = hexToRgb(options.color);
                
                let x, y;
                const margin = 30;

                switch (options.position) {
                    case 'top-left':      x = margin; y = height - margin; break;
                    case 'top-center':    x = (width - textWidth) / 2; y = height - margin; break;
                    case 'top-right':     x = width - textWidth - margin; y = height - margin; break;
                    case 'bottom-left':   x = margin; y = margin; break;
                    case 'bottom-center': x = (width - textWidth) / 2; y = margin; break;
                    case 'bottom-right':  x = width - textWidth - margin; y = margin; break;
                }

                page.drawText(numberText, {
                    x, y,
                    font: helveticaFont,
                    size: options.fontSize,
                    color: rgb(colorComponents.r, colorComponents.g, colorComponents.b),
                });
            }

            const pdfBytes = await pdfDoc.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            saveAs(blob, `numerado-${file.name}`);
            showUserMessage('PDF numerado com sucesso!', 'success');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const toolBtn = document.getElementById('tool-btn');
            const fileInput = document.getElementById('tool-input');
            const fileInfo = document.getElementById('file-info');
            const uploadArea = document.querySelector('.upload-area');

            uploadArea.addEventListener('click', (e) => { if(e.target.tagName !== 'INPUT') fileInput.click(); });
            uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('active'); });
            uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('active'));
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('active');
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    fileInput.dispatchEvent(new Event('change'));
                }
            });

            fileInput.addEventListener('change', () => {
                fileInfo.textContent = fileInput.files.length > 0 ? `Arquivo: ${fileInput.files[0].name}` : '';
            });

            toolBtn.addEventListener('click', async () => {
                if (fileInput.files.length === 0) {
                    return showUserMessage('Por favor, selecione um arquivo PDF.', 'error');
                }
                
                const options = {
                    position: document.getElementById('position').value,
                    format: document.getElementById('format').value,
                    startPage: parseInt(document.getElementById('start-page').value, 10),
                    fontSize: parseInt(document.getElementById('font-size').value, 10),
                    color: document.getElementById('font-color').value,
                };

                const originalText = toolBtn.textContent;
                toolBtn.textContent = 'Processando...';
                toolBtn.disabled = true;

                try {
                    await addPageNumbersToPdf(fileInput.files[0], options);
                } catch (e) {
                    showUserMessage(e.message, 'error');
                    console.error(e);
                } finally {
                    toolBtn.textContent = originalText;
                    toolBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>